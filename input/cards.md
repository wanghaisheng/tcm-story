使用华丽的游戏化风格设计卡牌图鉴的展示 # 卡牌系统设计文档（cards-design.md） ## 一、卡牌类型与字段 ### 1. 草药卡（Herb Card） - **基础字段**： - id（主键，UUID） - name（名称） - description（描述） - rarity（稀有度） - category（类别，固定为“herb”） - color（颜色/标签） - effects（功能说明，数组） - story（故事/典故） - created_at（创建时间） - **专属字段**： - chemical_components（化学成分，数组或JSON） - meridian_entry（归经，数组） - property_flavor（四气五味归属，JSON） - origin（来源地） ### 2. 方剂卡（Formula Card） - **基础字段**：同上，category 固定为“formula” - **专属字段**： - herbs（草药搭配，多对多，关联herb卡） - usage（用法） - effect（治疗效果） - instruction（制作说明） - origin（来源） - story（典故） ### 3. 症候卡（Syndrome Card） - **基础字段**：同上，category 固定为“syndrome” - **专属字段**： - treatable_by_formulas（可被哪些方剂治疗，多对多，关联formula卡） - atomic_syndromes（原子症候组合，数组） - symptoms（症状，多对多，关联症状表） - diseases（疾病名称，多对多，关联疾病表） ### 4. 症状卡（Symptom Card） - **基础字段**：同上，category 固定为“symptom” - **专属字段**： - related_syndromes（关联症候，多对多，关联syndrome卡） - related_diseases（关联疾病，多对多，关联disease卡） - symptom_type（症状类型，如主症/次症等） - severity（严重程度，可选） --- ## 各关系表用途说明与典型业务场景 ### card_formula_herbs（方剂-草药多对多） - 用途：描述每个方剂由哪些草药组成及其用量。 - 典型场景：前端展示方剂详情时，显示其成分草药列表及用量。 ### card_syndrome_formulas（症候-方剂多对多） - 用途：描述每个症候可被哪些方剂治疗。 - 典型场景：用户查看症候卡时，展示推荐治疗方剂。 ### card_syndrome_symptoms（症候-症状多对多） - 用途：描述每个症候包含哪些症状。 - 典型场景：症候详情页展示其典型表现症状。 ### card_syndrome_diseases（症候-疾病多对多） - 用途：描述症候与疾病的关联。 - 典型场景：医学知识图谱、疾病溯源分析。 ### card_symptom_diseases（症状-疾病多对多） - 用途：描述症状与疾病的直接关联。 - 典型场景：症状检索疾病、辅助诊断。 ### combination_cards（组合-卡牌多对多） - 用途：描述组合卡涉及的所有基础卡牌。 - 典型场景：组合效果触发、卡牌搭配推荐。 --- ## 设计优化建议 - 为所有关系表增加唯一索引（如PRIMARY KEY）和必要的外键约束，确保数据一致性。 - 在前端和后端逻辑中明确关系类型（如成分组合、治疗组合、表现组合等），便于动态展示和业务处理。 - 预留扩展字段（如jsonb）以支持未来新型关系。 - 文档中补充各关系表用途说明和典型业务场景，提升可读性和开发指导性。 ### 5. 疾病名称卡（Disease Card） - **基础字段**：同上，category 固定为“disease” - **专属字段**： - related_syndromes（关联症候，多对多，关联syndrome卡） - related_symptoms（关联症状，多对多，关联symptom卡） - icd_code（ICD编码，可选） - disease_type（疾病类型） - severity（严重程度，可选） --- ## 典型卡牌组合关系梳理 ### 1. 草药与草药的组合关系（作为方剂成分） - **定义**：若两种或多种草药共同作为某一方剂的成分，则它们之间存在“成分组合”关系。 - **结构化描述**： - 组合类型：草药-草药（方剂成分） - 关联表：card_formula_herbs（formula_id, herb_id, amount） - 示例： - 甘草 + 黄芪 → 组成方剂“补气汤” - 关联方式：通过方剂卡的 herbs 字段和 card_formula_herbs 关系表实现 ### 2. 方剂与方剂的组合关系（作为症候治疗方法） - **定义**：若两种或多种方剂共同作为某一症候的治疗方法，则它们之间存在“治疗组合”关系。 - **结构化描述**： - 组合类型：方剂-方剂（症候治疗） - 关联表：card_syndrome_formulas（syndrome_id, formula_id） - 示例： - “补中益气汤” + “参苓白术散” → 治疗“气虚症候” - 关联方式：通过症候卡的 treatable_by_formulas 字段和 card_syndrome_formulas 关系表实现 ### 3. 症状与症状的组合关系（作为某种症候的表现） - **定义**：若两种或多种症状共同作为某一症候的表现，则它们之间存在“表现组合”关系。 - **结构化描述**： - 组合类型：症状-症状（症候表现） - 关联表：card_syndrome_symptoms（syndrome_id, symptom_id） - 示例： - “乏力” + “面色苍白” → 构成“气虚症候” - 关联方式：通过症候卡的 symptoms 字段和 card_syndrome_symptoms 关系表实现 --- ## 前端展示建议 - 针对上述三类组合关系，前端可在卡牌详情页或组合关系页中，分别以“成分组合”、“治疗组合”、“表现组合”三种类型进行结构化展示。 - 建议实现 CardRelations 组件，支持根据卡牌类型和关系类型动态渲染对应的关联信息。 - 典型交互： - 用户查看某草药卡时，可直观看到其与其他草药共同组成的方剂列表。 - 用户查看某方剂卡时，可看到其与其他方剂共同作为哪些症候的治疗方法。 - 用户查看某症状卡时，可看到其与其他症状共同构成的症候。 - 组合关系可高亮、分组、支持点击跳转至对应卡牌详情。 --- ## 二、表结构建议 ### 1. cards（主卡牌表） - id uuid PRIMARY KEY - name text NOT NULL - description text - rarity text NOT NULL - category text NOT NULL // 支持 "herb"、"formula"、"syndrome"、"symptom"、"disease" - color text NOT NULL - effects text[] - story text - created_at timestamptz DEFAULT now() ### 2. card_herb_details（草药卡专属字段表） - card_id uuid PRIMARY KEY REFERENCES cards(id) - chemical_components text[] - meridian_entry text[] - property_flavor jsonb - origin text ### 3. card_formula_details（方剂卡专属字段表） - card_id uuid PRIMARY KEY REFERENCES cards(id) - usage text - effect text - instruction text - origin text - story text ### 4. card_formula_herbs（方剂-草药多对多） - formula_id uuid REFERENCES cards(id) - herb_id uuid REFERENCES cards(id) - amount text（用量/比例） - PRIMARY KEY(formula_id, herb_id) ### 5. card_syndrome_details（症候卡专属字段表） - card_id uuid PRIMARY KEY REFERENCES cards(id) - atomic_syndromes text[] ### 6. card_syndrome_formulas（症候-方剂多对多） - syndrome_id uuid REFERENCES cards(id) - formula_id uuid REFERENCES cards(id) - PRIMARY KEY(syndrome_id, formula_id) ### 7. card_syndrome_symptoms（症候-症状多对多） - syndrome_id uuid REFERENCES cards(id) - symptom_id uuid（可关联症状表） - PRIMARY KEY(syndrome_id, symptom_id) ### 8. card_syndrome_diseases（症候-疾病多对多） - syndrome_id uuid REFERENCES cards(id) - disease_id uuid（可关联疾病表） - PRIMARY KEY(syndrome_id, disease_id) ### 9. card_symptom_details（症状卡专属字段表） - card_id uuid PRIMARY KEY REFERENCES cards(id) - symptom_type text（症状类型，如主症/次症等） - severity text（严重程度，可选，轻/中/重等） - onset_time text（起病时间/持续时间，可选） - location text（部位，可选） - related_factors text（诱因/加重因素，可选） - relief_factors text（缓解因素，可选） - description text（补充说明，可选） ### 10. card_disease_details（疾病名称卡专属字段表） - card_id uuid PRIMARY KEY REFERENCES cards(id) - icd_code text（ICD编码，可选） - disease_type text（疾病类型，如中医/西医分类等） - severity text（严重程度，可选） - onset_age text（好发年龄/人群，可选） - affected_system text（涉及系统/器官，可选） - clinical_stage text（临床分期，可选） - description text（补充说明，可选） ### 11. card_symptom_diseases（症状-疾病多对多） - symptom_id uuid REFERENCES cards(id) - disease_id uuid REFERENCES cards(id) - PRIMARY KEY(symptom_id, disease_id) ## 三、掉落配置 ### 1. task_card_drops（关卡掉落配置表） - id uuid PRIMARY KEY - task_id uuid（关卡/任务ID） - level_id uuid（关卡等级ID） - card_id uuid（掉落卡牌ID） - rarity text - drop_chance decimal（掉落概率0-100） - min_score integer（最低分数要求） - created_at timestamptz ### 2. 配置说明 - 不同关卡可配置掉落的草药、方剂、症候卡牌 - 可按关卡等级、稀有度、概率、分数等灵活配置 ## 四、扩展性建议 - 每类卡牌专属字段独立表，便于后续扩展新类型卡牌 - 多对多关系表支持复杂搭配与组合 - category 字段可扩展更多类型（如“技能”、“装备”等） - 预留 JSON 字段支持灵活扩展 ## 五、关联关系示意 - 方剂卡与草药卡：多对多（card_formula_herbs） - 症候卡与方剂卡：多对多（card_syndrome_formulas） - 症候卡与症状/疾病：多对多（card_syndrome_symptoms/card_syndrome_diseases） ## 六、卡牌组合与关联关系细分设计 ### 1. 草药卡（Herb Card）组合 - **组合类型**： - 协同组合：两味或多味草药联合使用时产生增强或新功效。 - 互斥组合：两味或多味草药同用时效果抵消或产生副作用。 - **结构建议**： - 字段：id、name、description、herb_ids（数组）、effect、type（协同/互斥）、判定规则、created_at - 判定逻辑： - 协同：如“甘草+黄芪=补气协同”，需在组合表中配置。 - 互斥：如“附子+半夏=药性冲突”，配置副作用说明。 - **数据结构举例**： - type: "herb_synergy" / "herb_conflict" - herb_ids: ["甘草", "黄芪"] - effect: "补气效果增强" 或 "易致毒副作用" ### 2. 方剂卡（Formula Card）组合与关联 - **组合/关联类型**： - 方剂-方剂协同/进阶组合：如两方剂联合用于某症候，产生更强治疗效果。 - 方剂-草药成分组合：已通过 card_formula_herbs 关系表实现。 - **结构建议**： - type: "formula_synergy" / "formula_advanced" - formula_ids: ["补中益气汤", "参苓白术散"] - effect: "治疗气虚症候效果增强" - 判定规则：需配置在组合表或业务逻辑中。 ### 3. 症状卡（Symptom Card）组合与关联 - **组合类型**： - 症状-症状组合：多种症状共同构成某一症候。 - **结构建议**： - type: "symptom_combination" - symptom_ids: ["乏力", "面色苍白"] - syndrome_id: "气虚症候" - 判定规则：通过 card_syndrome_symptoms 关系表实现。 ### 4. 症候卡（Syndrome Card）组合与关联 - **组合/关联类型**： - 症候-方剂组合：某症候可被多种方剂治疗。 - 症候-症状组合：某症候由多个症状表现。 - 症候-疾病关联：某症候与多种疾病相关。 - **结构建议**： - 已通过 card_syndrome_formulas、card_syndrome_symptoms、card_syndrome_diseases 等关系表实现。 ### 5. 疾病卡（Disease Card）关联 - **关联类型**： - 疾病-症候、疾病-症状关联。 - **结构建议**： - 已通过 card_syndrome_diseases、card_symptom_diseases 等关系表实现。 ### 6. 组合卡（Combination Card）扩展 - **用途**：描述多张卡牌（不限类型）组合后产生的特殊效果、能力或事件。 - **字段建议**： - id、name、description、cards（参与组合的卡牌ID及类型）、effect、power、type（协同/互斥/进阶/跨类型等）、unlock_condition、判定规则、created_at - **组合类型举例**： - herb_synergy：草药协同 - herb_conflict：草药互斥 - formula_synergy：方剂协同 - symptom_combination：症状组合 - syndrome_formula：症候-方剂 - syndrome_symptom：症候-症状 - disease_syndrome：疾病-症候 - disease_symptom：疾病-症状 - cross_type：跨类型组合（如草药+方剂+症状） - **判定规则**： - 明确每种组合类型的判定条件（如参与卡牌类型、数量、顺序、特殊条件等），便于前后端实现。 ### 7. 组合与界面设计建议 - 前端应支持： - 针对不同类型组合的高亮、分组与跳转 - 组合类型标签（如“协同”、“互斥”、“进阶”、“跨类型”） - 动态提示组合可用性、解锁条件、互斥警告等 - 典型场景： - 用户选择多张草药卡时，自动检测协同/互斥组合并高亮显示 - 用户查看方剂卡时，展示其与其他方剂/草药的组合关系 - 用户查看症状卡时，展示其与其他症状共同构成的症候 - 支持跨类型组合的展示与跳转 ### 8. 数据结构与表设计建议 - 组合表（combinations） - id uuid PRIMARY KEY - name text NOT NULL - description text - effect text - power integer - type text - unlock_condition text - rule text（判定规则说明） - created_at timestamptz DEFAULT now() - 组合-卡牌关联表（combination_cards） - combination_id uuid REFERENCES combinations(id) - card_id uuid REFERENCES cards(id) - card_type text - PRIMARY KEY(combination_id, card_id) ### 9. 组合类型与判定规则举例 - 草药协同：参与卡牌均为草药，type="herb_synergy" - 草药互斥：参与卡牌均为草药，type="herb_conflict" - 方剂协同：参与卡牌均为方剂，type="formula_synergy" - 症状组合：参与卡牌均为症状，type="symptom_combination" - 跨类型组合：如草药+方剂+症状，type="cross_type" - 判定规则：如需顺序、数量、特殊条件等，需在 rule 字段中详细说明。 --- 如需进一步细化字段、表结构或界面交互，可结合实际业务需求和前端实现细节持续完善。 ## 设计说明补充 - card_symptom_details 表建议补充 onset_time、location、related_factors、relief_factors、description 字段，以便更细致描述症状表现，支持前端多维度展示和检索。 - card_disease_details 表建议补充 onset_age、affected_system、clinical_stage、description 字段，便于疾病卡在医学知识图谱、临床分型等场景下的扩展。 - 所有补充字段均为可选，便于后续灵活扩展和兼容不同数据来源。 

